<%= provide(:title, "Add A Track") %>
<div class="buffalo">
  <div class="delaware">
    <div class="elmwood">
      <div class="harlem">
        <h1>add a track to <%= @album.title %></h1>
      </div>

      <%= form_for(@track, url: artist_album_tracks_path, html: { class: 'directUpload', data: { 'form-data' => (@s3_direct_post.fields), 'url' => @s3_direct_post.url, 'host' => URI.parse(@s3_direct_post.url).host } }) do |f| %>
        <%= f.hidden_field :artist_id %>
        <%= f.hidden_field :artist_album_id %>
        <%= render 'errors/track_errors' %>

        <div class="northrup">
          <div class="amherst temp">
            track play url
          </div>
          <%= f.file_field :track_url, class: "musicInput" %>
          <div class="uploadButton">upload</div>
        </div>

        <div class="highgate">
          <div class="amherst temp">
            title
          </div>
          <%= f.text_field :title, class: "huron" %>
        </div>
        <div class="maryland">
          <div class="amherst temp">
            number
          </div>
          <%= f.text_field :number, class: "huron" %>
        </div>
        <div class="maryland">
          <div class="amherst temp">
            price
          </div>
          <%= f.text_field :price, class: "huron" %>
        </div>
        <div class="maryland">
          <div class="amherst temp">
            currency
          </div>
          <%= f.select :currency, options_for_select(currency_select)%>
        </div>
        <div class="highgate">
          <div class="amherst temp">
            lyrics
          </div>
          <%= f.text_area :lyrics, class: "chippewa" %>
        </div>
        <div class="ellicott">
          <%= f.submit "add track", data: { disable_with: 'posting...' }, class: "exchange" %>
        </div>
      <% end %>


    </div>
  </div>
</div>
<%= render 'partials/uni_footer' %>

<script type="text/javascript">
$(function() {
  var fileInput = $('.musicInput');
  var form = $(fileInput.parents('form:first'));
  var submitButton = form.find('input[type="submit"]');
  var progressBar = $("<div class='bar'></div>");
  var barContainer = $("<div class='progress'></div>").append(progressBar);
  fileInput.after(barContainer);
  fileInput.fileupload({
    fileInput: fileInput,
    url: form.data('url'),
    type: 'POST',
    autoUpload: false,
    formData: form.data('form-data'),
    paramName: 'file',
    dataType: 'XML',
    replaceFileInput: false,
    add: function (e, data) {
      $('.uploadButton').show();
      $('.uploadButton').click(function() {
        data.submit();
      });
    },
    progress: function (e, data) {
      var progress = parseInt(data.loaded / data.total * 100, 10);
      progressBar.css('width', progress + '%')
    },
    start: function (e) {
      submitButton.prop('disabled', true);
      progressBar.
        css('background', 'green').
        css('display', 'block').
        css('width', '0%').
        text("Loading...");
    },
    done: function(e, data) {
      submitButton.prop('disabled', false);
      progressBar.text("Upload finished.");
      $('.uploadButton').hide();
      var key   = $(data.jqXHR.responseXML).find("Key").text();
      var url   = form.data('url') + '/' + key;
      var input = $("<input />", { type:'hidden', name: fileInput.attr('name'), value: url })
      form.append(input);
    },
    fail: function(e, data) {
      submitButton.prop('disabled', false);
      progressBar.
        css("background", "red").
        text("Failed");
    }
  });
});
</script>
